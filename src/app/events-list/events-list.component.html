<header
  class="bg-white/20 backdrop-blur-2xl shadow-2xl rounded-b-3xl relative z-10 border-b-2 border-white/30 py-10 flex flex-col items-center"
>
  <h1
    class="text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-700 via-fuchsia-600 to-pink-500 drop-shadow-2xl tracking-tight text-center mb-2 flex items-center justify-center gap-3"
    style="letter-spacing: 0.04em"
  >
    <img
      src="../images.png"
      alt="Logo"
      class="inline-block h-12 w-12 md:h-14 md:w-14 mr-2 align-middle drop-shadow-lg bg-white/80 rounded-full p-1"
    />
    <span class="text-white align-middle">  Events Management</span>
  </h1>
  <p
    class="text-lg md:text-xl font-semibold text-white drop-shadow-sm text-center mt-2 tracking-wide"
  >
    View and discover upcoming events and announcements
  </p>
</header>
<app-navbar *ngIf="!selectedEvent && !editSelectedEvent"></app-navbar>

<h2 class="text-3xl font-bold text-center text-blue-700 mb-6">Upcoming Events</h2>
<!-- Toast Notification -->
<div *ngIf="toastVisible" class="max-w-2xl mx-auto px-4 pb-16 top-4 py-3 z-[100]">
  <div [ngClass]="{
      'bg-green-500/90': toastType==='success',
      'bg-red-600/90': toastType==='error'
    }" class="text-white px-5 py-3 rounded-xl shadow-xl flex items-center gap-3 backdrop-blur-sm border border-white/30 animate-fade-in">
    <svg *ngIf="toastType==='success'" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 00-1.414-1.414L8 11.172 4.707 7.879a1 1 0 10-1.414 1.414L8 14l8.707-8.707z" clip-rule="evenodd"/></svg>
    <svg *ngIf="toastType==='error'" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>
    <span class="font-semibold">{{ toastMessage }}</span>
  </div>
</div>
<ng-container *ngIf="events$ | async as events; else noEvents">
  <div *ngIf="events.length > 0; else noEvents" class="flex justify-center">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 w-full max-w-6xl px-4 pb-16">
      <div
        *ngFor="let event of events"
        (click)="selectEvent(event, $event)"
       class='bg-white/95 rounded-3xl shadow-xl hover:shadow-pink-200 transition-all duration-300 border-l-8 border-indigo-400 p-7 cursor-pointer group relative overflow-hidden flex flex-col justify-end' [style.background-image]="'url(' + bgFor(event.eventTitle) + ')'" style="background-size:cover;background-position:center;"
      >
        <div
          class="absolute inset-0 bg-white/60 group-hover:bg-white/40 transition-all duration-300"
        ></div>
        <div class="relative z-10">
          <h3
           class='text-2xl font-extrabold text-indigo-700 mb-4 flex items-center gap-2 group-hover:text-pink-500 transition-colors duration-300'  
          >
          <svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-indigo-900' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/></svg>
        <!-- Admin action buttons -->
       
            {{ event.eventTitle }}
          </h3>
          <div
           class='bg-indigo-50 inline-block px-4 py-1 rounded-full text-sm text-indigo-700 font-semibold mb-4 shadow-sm'
          >
            {{ event.eventDate | date:'MMMM d, yyyy \'at\' h:mm a'  }} 
          </div>
          <div class="text-purple-700 font-medium mb-2 flex items-center gap-2">
           <svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 text-purple-900' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 11c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm0 2c-2.21 0-4 1.79-4 4 0 2.21 4 7 4 7s4-4.79 4-7c0-2.21-1.79-4-4-4z'/></svg>
            {{ event.location }}
          </div>
           <div *ngIf="isAdmin" class="absolute left-0 right-0 bottom-2 flex gap-2 py-3 backdrop-blur-sm border-t border-indigo-100 rounded-b-3xl opacity-0 translate-y-0 group-hover:opacity-100 group-hover:translate-y-10 transition-all duration-300 z-20 pointer-events-none group-hover:pointer-events-auto px-4 admin-actions">
          <button type="button" (click)="onEditClick(event, $event)" class="inline-flex items-center gap-2 px-4 py-1.5 rounded-lg font-semibold text-white bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 shadow-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5h2m-1 0v14m-7-7h14"/></svg>
            Edit
          </button>
          <button type="button" (click)="confirmDelete(event); $event.stopPropagation();" class="inline-flex items-center gap-2 px-4 py-1.5 rounded-lg font-semibold text-white bg-gradient-to-r from-rose-500 via-pink-500 to-red-600 hover:from-rose-600 hover:to-red-700 shadow-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-rose-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            Delete
          </button>
        </div>
        </div>
      </div>
    </div>
  </div>

  <!-- View Modal -->
  <div *ngIf="selectedEvent" class="fixed inset-0 z-50 flex items-center justify-center" role="dialog" aria-modal="true" [attr.aria-label]="selectedEvent.eventTitle" (keydown.escape)="closeModal()" [style.background-image]="'url(' + bgFor(selectedEvent.eventTitle) + ')'" [style.background-size]="'cover'" [style.background-position]="'center'">
    <div class="absolute inset-0 bg-black/40" (click)="closeModal()"></div>
    <div class="relative z-10 max-w-2xl w-full mx-4 animate-glass-in" (click)="$event.stopPropagation()">
      <div class="glass-modal">
        <div class="absolute inset-0 bg-cover bg-center" aria-hidden="true"></div>
        <div class="glass-modal-content p-8 sm:p-12 flex flex-col gap-8">
          <div class="flex items-start justify-between gap-4 mb-6">
            <div class="flex-1 pr-2">
              <h2 id="modalTitle" class="text-4xl sm:text-5xl font-black text-white leading-tight flex items-center gap-3 drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)] font-sans"><svg xmlns='http://www.w3.org/2000/svg' class='h-10 w-10 text-pink-300' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/></svg><span>{{ selectedEvent.eventTitle }}</span></h2>
              <div class="mt-3 text-lg text-white font-bold flex items-center gap-2 font-sans drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)]" id="modalDateWrap"><svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-indigo-200' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/></svg><span>{{selectedEvent.eventDate | date:'MMMM d, yyyy \'at\' h:mm a'}}</span></div>
            </div>
            <div class="flex-shrink-0 flex gap-2">
              <button type="button" (click)="closeModal()" class="px-4 py-2 rounded-lg font-semibold bg-white/20 text-white border border-black/30 hover:bg-white/30 backdrop-blur-sm">Close</button>

            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
            <div class="flex-1 pr-2">
              <h3 class="text-lg font-extrabold text-white mb-3 flex items-center gap-2 uppercase tracking-wide font-sans drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)]"><svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-purple-200' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 11c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm0 2c-2.21 0-4 1.79-4 4 0 2.21 4 7 4 7s4-4.79 4-7c0-2.21-1.79-4-4-4z'/></svg>Location</h3>
              <div class="text-white font-bold flex items-center gap-2 bg-purple-900/40 rounded-xl px-5 py-3 shadow-sm text-base font-sans drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)]">
                <span class="text-white font-semibold">{{ selectedEvent.location }}</span>
              </div>
            </div>
            <div>
              <h3 class="text-lg font-extrabold text-white mb-3 flex items-center gap-2 uppercase tracking-wide font-sans drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)]"><svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6 text-indigo-200' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/></svg>Details</h3>
              <p id="modalDetails" class="text-white font-medium leading-relaxed max-h-60 overflow-auto bg-indigo-900/40 rounded-xl px-5 py-3 shadow-sm text-base font-sans drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)]">{{ selectedEvent.details }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal (outside selectedEvent block so it can open independently) -->
  <div *ngIf="editSelectedEvent" class="fixed inset-0 z-[60] flex items-center justify-center" (keydown.escape)="closeEditModal()" tabindex="-1" [style.background-image]="'url(' + bgFor(editSelectedEvent.eventTitle) + ')'" [style.background-size]="'cover'" [style.background-position]="'no-repeat'">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" (click)="closeEditModal()"></div>
    <div class="relative w-full max-w-xl mx-4 animate-glass-in">
      <div class="glass-modal">
        <div class="absolute inset-0 bg-cover bg-center"  aria-hidden="true"></div>
        <form *ngIf="editModel" (submit)="$event.preventDefault(); saveEdit();" class="glass-modal-content p-8 flex flex-col gap-6">
          <div class="flex items-start justify-between mb-4">
            <h2 class="text-3xl font-black text-white">Edit Event</h2>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div class="space-y-3">
              <label class="text-sm font-semibold text-white flex items-center gap-2"><svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 text-pink-200' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/></svg>Title</label>
              <input [(ngModel)]="editModel!.eventTitle" name="event_title" required maxlength="255" placeholder="Title" class="w-full rounded-xl bg-white/20 border border-white/30 backdrop-blur-md px-4 py-2 text-black placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-300" />
              <label class="text-sm font-semibold text-white flex items-center gap-2"><svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 text-indigo-200' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/></svg>Date</label>
              <input type="date" [(ngModel)]="editDateISO" (ngModelChange)="onDateChange($event)" name="editDateISO" required [min]="minDate" class="w-full rounded-xl bg-white/20 border border-white/30 backdrop-blur-md px-4 py-2 text-black focus:outline-none focus:ring-2 focus:ring-indigo-300" />
              <label class="text-sm font-semibold text-white flex items-center gap-2 mt-3"><svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 text-indigo-200' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/></svg>Time</label>
              <input type="time" [(ngModel)]="editTimeISO" name="editTimeISO" (ngModelChange)="onTimeChange($event)" [min]="minTime" required class="w-full rounded-xl bg-white/20 border border-white/30 backdrop-blur-md px-4 py-2 text-black focus:outline-none focus:ring-2 focus:ring-indigo-300" />
               <div *ngIf="editDateISO && editTimeISO">
                <div *ngIf="isSelectedInPast()" class="text-xs text-red-300 mt-1">Selected date/time is in the past.</div>
              </div>
              <div class="mt-2 text-xs font-semibold text-white/80">Selected: {{ editDisplayDate | date:'MMMM d, yyyy' }} {{ editDisplayTime }}</div>
            </div>
            <div class="space-y-3">
              <label class="text-sm font-semibold text-white flex items-center gap-2"><svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 text-purple-200' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 11c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm0 2c-2.21 0-4 1.79-4 4 0 2.21 4 7 4 7s4-4.79 4-7c0-2.21-1.79-4-4-4z'/></svg>Location</label>
              <input [(ngModel)]="editModel!.location" name="location" required maxlength="255" placeholder="Location" class="w-full rounded-xl bg-white/20 border border-white/30 backdrop-blur-md px-4 py-2 text-black placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-300" />
              <label class="text-sm font-semibold text-white flex items-center gap-2"><svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 text-indigo-200' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/></svg>Details</label>
              <textarea [(ngModel)]="editModel!.details" name="details" rows="5" placeholder="Details" class="w-full rounded-xl bg-white/20 border border-white/30 backdrop-blur-md px-4 py-2 text-black placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-300"></textarea>
            </div>
          </div>
          <div class="flex justify-end gap-3 pt-2">
            <button type="button" (click)="closeEditModal()" class="px-4 py-2 rounded-lg font-semibold bg-white/20 text-white border border-white/30 hover:bg-white/30 backdrop-blur-sm">Cancel</button>
            <button type="submit" class="px-4 py-2 rounded-lg font-semibold text-white bg-gradient-to-r from-green-500 via-emerald-500 to-teal-600 hover:from-green-600 hover:to-teal-700 shadow">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</ng-container>
<ng-template #noEvents>
  <p class="text-center text-gray-500 mt-8">No upcoming events found.</p>
</ng-template>
